<head>
<!-- <meta http-equiv="refresh" content="5"/> -->
<script src="https://unpkg.com/vue@3"></script>
<style type="text/less">
body { 
	margin:0 ;
	font-size: calc(1em + 10vmin);
article {
  display: grid;
  height: calc(100% - 1px);
  justify-content: center;
  align-content: center;
 	grid-auto-rows: 1fr;
  @media (orientation: portrait) {
  	grid-template-columns: repeat(2, 6fr);
  }
  @media (orientation: landscape) {
  	grid-template-columns: repeat(3, 4fr);
  }
  > div {
		&:active {
		  	background: silver;
		}
	  justify-content: center;
	  display: flex;
	  align-items: center;
	  text-align: center;
      border: 1px solid #000; /* ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ñ€Ð°Ð¼ÐºÐ¸ */
  }
}
}
</style>

<script src="https://cdn.jsdelivr.net/npm/less@3" ></script>

<script type="text/html" id="tempBody">
<!-- 		 <p>{{ message }}</p>
		 <button v-on:click="reverseMessage">Reverse Message</button> -->
<article>
   <comp-time />
   <comp-weather />
   <div>ðŸ”‘<br />OFF</div>
   <div>ðŸ’¡<br />OFF</div>
   <div>ðŸ’¡<br />OFF</div>
   <div style="filter: grayscale(1);">ðŸ’¡</div>
</article>
</script>

<!-- 
<script type="text/html" id="tempTime">
	asd
</script>
 -->
</head>
<body>
</body>

<script>
const ref = (a) => Vue.ref(a)
const defineAsyncComponent = (a) => Vue.defineAsyncComponent(a)

const compTime = {
	name: "Time",
	template: `<div>{{time.slice(0,5)}}</div>`,
	setup() {
		const timer = ref(null)
		const time = ref("00:00")
		const formattedTime = (d = new Date()) => {
			return [d.getHours(), d.getMinutes(), d.getSeconds()]
				.map((n) => (n < 10 ? `0${n}` : `${n}`))
				.join(":")
		}

		const updateTime = () => {
			const cd = new Date()
			time.value = formattedTime()
		}

		const startTimer = () => {
			timer.value = setInterval(() => {
				updateTime()
			}, 1000)
		}

		const stopTimer = () => {
			clearTimeout(timer)
		}
		Vue.onBeforeMount(updateTime)
		Vue.onMounted(startTimer)
		Vue.onUnmounted(stopTimer)
		return { time }
	},
}

const compAsync = defineAsyncComponent(async () => {
	const weather = (await (await fetch('https://api.openweathermap.org/data/2.5/weather?q=Kazan&lang=ru&units=metric&appid=c80f014c14afe2fb19a19dbf7d3d0ca1')).json())
	return {
		template: `<div>${[weather.main.temp].map((n) => (n < 0 ? `-${n}` : `+${n}`))}ËšC</div>`,
	}
})

const compWeather = {
	components: { compAsync },
	template: `<div @click="fetchData">{{data}}ËšC</div>`,
        setup() {
	    const data = ref(0);
	    const loading = ref(true);
	    const error = ref(null);

	    const fetchData = async()=> {
	    	data.value = [ (await (await fetch('https://api.openweathermap.org/data/2.5/weather?q=Kazan&lang=ru&units=metric&appid=c80f014c14afe2fb19a19dbf7d3d0ca1')).json()).main.temp ].map((n) => (n < 0 ? `-${n}` : `+${n}`))[0]
	      // Will be implemented next
	    }

	    Vue.onBeforeMount(fetchData)
	    return {
	      data,
	      loading,
	      error,
	      fetchData
	    }
	  }
	}






	// setup() {
	// 	const weather = ref("Fetch")
	// 	// const weather2 = (await (await fetch('https://api.openweathermap.org/data/2.5/weather?q=Kazan&lang=ru&units=metric&appid=c80f014c14afe2fb19a19dbf7d3d0ca1')).json())
	// 	return { weather } // anything returned here will be available for the rest of the component
	// },


const vApp = Vue.createApp({
	template: "#tempBody",
	components: { compTime, compWeather },
}).mount("body")
</script>
